#! /usr/bin/bash

source ./createFunc
source ./useFunc
source ./renameDatabaseFunc
source ./dropDatabaseFunc
source ./listDatabasesFunc
source ./dropTableFunc
source ./insertIntoFunc
source ./truncateTableFunc
source ./showTablesFunc

shopt -s extglob

declare -i exit=0
until [[ $exit -eq 1 ]]
do 
    read -p "> " input
    eval "set -- $input"
    case $1 in
    +([Ee][Xx][Ii][Tt]))
        exit
        ;;
    +([cC][rR][eE][aA][tT][eE]))
        createFunc ${@:2}
        ;;
    +([uU][sS][eE]))
        if [[ $databaseInUse != "" ]]
        then
            cd ../..
            useFuncSQL ${@:2}
            echo $databaseInUse
        else
            useFuncSQL ${@:2}
        fi
        ;;
    +([dD][rR][oO][pP]))
    if [[ ${2} =~ ^[dD][aA][tT][aA][bB][aA][sS][eE]$ ]]
    then
        if [[ $databaseInUse != "" ]]
        then
            cd ../..
            dropDatabaseFuncSQL ${@:2}
                if [[ $removedDatabase = $databaseInUse ]]
                then
                    databaseInUse=""
                else
                    cd Databases/$databaseInUse
                fi

        else
            dropDatabaseFuncSQL ${@:2}
        fi
    elif [[ ${2} =~ ^[tT][aA][bB][lL][eE]$ ]]
    then
        if [[ $databaseInUse != "" ]]
        then
            dropTableFuncSQL ${@:2}
        else
            echo Please select a database first.
        fi
        ;;
    +([rR][eE][nN][aA][mM][eE]))
        if [[ $databaseInUse != "" ]]
        then
            cd ../..
            renameDatabaseFuncSQL ${@:2}
            databaseInUse=$newDatabaseName
            cd Databases/$databaseInUse
        else
            renameDatabaseFuncSQL ${@:2}
        fi
        ;;
    +([sS][hH][oO][wW]))
        if [[ ${2} =~ ^[dD][aA][tT][aA][bB][aA][sS][eE][sS]$ ]]
        then
            if [[ $databaseInUse != "" ]]
            then
                cd ../..
                listDatabasesFuncSQL ${@:2}
                cd Databases/$databaseInUse
            else
                listDatabasesFuncSQL ${@:2}
            fi
        elif [[ ${2} =~ ^[tT][aA][bB][lL][eE][sS]$ ]]
        then 
            if [[ $databaseInUse != "" ]]
            then
                showTablesFuncSQL ${@:2}
            else
                echo Please select a database first.
            fi
        fi
        ;;
    +([tT][rR][uU][nN][cC][aA][tT][eE]))
        if [[ ${2} =~ ^[tT][aA][bB][lL][eE]$ ]]
        then
            if [[ $databaseInUse != "" ]]
            then
                truncateTableSQL ${@:2}
            else
                echo Please select a database first.
            fi
        fi
        ;;
    +([Ii][Nn][Ss][Ee][Rr][Tt]))
        insertIntoFunc ${@:2}
        ;;
    *)
        echo Invalid input.
    esac
done

# #echo $databaseInUse